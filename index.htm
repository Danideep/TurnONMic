<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mic</title>
    <style>
        body {
            background-color: #ff6060;
            font-size: 18px;
            font-weight: bold;
            line-height: 1.8;
        }
        
        body.orange {
            background-color: #ffcc00;
        }
        
        .container {
            font-family: vazir;
            direction: rtl;
            max-width: 800px;
            padding: 1rem 2.5rem;
            margin: 2rem auto;
            background-color: #fff;
            min-height: 150px;
            border-radius: 10px;
            box-shadow: 0 10px 10px 0 rgba(0, 0, 0, .2);
        }
        
        @font-face {
            font-family: vazir;
            src: url(../mic/fonts/Vazir.ttf);
        }
    </style>
</head>

<body>
    <div class="container">

    </div>
    <script>
        window.SpeechRecognition = window.SpeechRecognition ||
            window.webkitSpeechRecognition;

        let container = document.querySelector('.container');
        let p = document.createElement('p');
        let span = document.createElement('span')

        const rec = new SpeechRecognition();
        rec.lang = 'fa-IR';
        rec.interinResults = true;

        rec.start();
        rec.addEventListener('end', rec.start);

        rec.addEventListener("result", (e) => {

            container.appendChild(p);
            let transcript = Array.from(e.results)
                .map((result) => {
                    return result[0]
                })
                .map((result) => {
                    return result.transcript
                })
                .join(' ')
            if (transcript.includes('علامت سوال')) {
                transcript = transcript.replace('علامت سوال', '؟')
            }
            if (transcript.includes('  گوسفند برو خط بعدی ')) {
                transcript = '';
                p = document.createElement('p');
                container.appendChild(p);
            }

            span.textContent = transcript + ' ';
            p.appendChild(span);
            console.log(transcript)
            if (e.results[0].isFinal) {
                span = document.createElement('span');
                p.appendChild(span);
            }
            if (transcript.includes('   گوسفند پاک کن ')) {
                container.innerHTML = '';
                p.innerHTML = '';
            }
        })
    </script>
</body>

</html>